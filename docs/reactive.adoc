= From Batch to Reactive: A Journey in Data Replication
:imagesdir: images/reactive
:page-url: https://decks.ruaux.org/reactive

{nbsp} +
{nbsp} +

---

Julien Ruaux mailto:julien@redis.com[julien@redis.com]

== The Pain ðŸ˜«

[%step]
* Replicating millions of keys between Redis instances
* How big should my batches be? ðŸ¤·
* How many threads do I need? ðŸ¤·
* What about queue sizes? ðŸ¤·
* Trial and error... forever tuning

[NOTE.speaker]
--
* RIOT does Redis replication using Spring Batch
* Every deployment is different
* Customers constantly asking: "What settings should I use?"
* No good answer - depends on network, data size, Redis version...
--

[background-image="fire-1.png",background-size="cover"]
== Imagine

[%step]
* A house on fire
* Putting out the fire = workload (requests)
* How do we move water from source to fire?

[background-image="fire-2.png",background-size="cover"]
== The Batch Way: Carrying Buckets

[%step]
* One thread = one person with buckets
* Fill bucket â†’ Walk to fire â†’ Pour â†’ Walk back
* Repeat

[%step]
*Problem:* Lots of waiting and idle time

[background-image="fire-3.png",background-size="cover"]
== Can We Carry Bigger Buckets?

[%step]
* Bigger bucket = larger batch size
* More data per trip
* But... heavier (more memory)
* Slower to fill and carry

[%step]
*Same problem:* Still waiting between trips

[background-image="fire-4.png",background-size="cover"]
== Can We Add More People?

[%step]
* More threads = more firefighters
* Need someone to coordinate them
* Synchronization overhead
* Can still run out of threads
* How many is optimal? ðŸ¤·

[%step]
*Complexity:* Coordination + tuning is hard

[background-image="fire-5.png",background-size="cover"]
== The Realization ðŸ’¡

[%step]
* The problem isn't the bucket size
* The problem isn't the number of people
* *The problem is the approach itself*

[%step]
What if we didn't carry buckets at all?

[NOTE.speaker]
--
* We're optimizing the wrong thing
* Batch processing is fundamentally limited
* There's a better way...
--

[background-image="fire-6.png",background-size="cover"]
== The Reactive Way: A Water Pump

[%step]
* Stream, don't batch
* Publisher â†’ Pipe â†’ Subscriber
* Water flows continuously as needed

[%step]
*Backpressure:* Subscriber controls the flow

[%step]
* "Give me 10 items right now"
* No overwhelming the target
* Natural flow control

[NOTE.speaker]
--
* Publisher (water source) â†’ Pipe â†’ Subscriber (fire)
* Continuous stream - no buckets, no walking, no waiting
* Backpressure is the killer feature
* Subscriber tells Publisher how much it can handle
* Prevents cascading failures
--

== Where Did This Come From?

[%step]
* *2009-2012*: Reactive principles (Rx.Net, Reactive Streams)
* *2015*: Language support
* *Today:* RxJS, Reactor, Rx.NET, RxPy, Tokio

[NOTE.speaker]
--
* Started at Microsoft with Rx.NET in 2009
* Reactive Manifesto (2013) defined principles
* Reactive Streams (2014) standardized JVM implementations
* Not a new fad - 15+ years of evolution
* Available in virtually every major language
* Project Reactor is Spring's implementation
--

== The Catch: Need Reactive All The Way

[quote]
You can't have a reactive pipe if one end is blocking

[%step]
* Reactive drivers (non-blocking I/O)
* Reactive servers (if building web apps)

[NOTE.speaker]
--
* Redis has Lettuce (reactive) âœ…
* Relational DBs: R2DBC available for Postgres, MySQL, etc.
* Some databases only have blocking drivers
* You CAN use blocking calls, but you lose the benefits
--

== Why This Matters: Solving the Pain

[%step]
* âœ… *No more tuning guesswork:* Fewer knobs to turn
* âœ… *Automatic flow control* (Backpressure)
* âœ… *Better resource usage* (reduce idle time)
* âœ… *Simpler codebase:* ~4000 LOC â†’ ~500 LOC

[NOTE.speaker]
--
* Remember the pain: "How many threads? What batch size?"
* Reactive doesn't eliminate ALL tuning, but drastically simplifies it
* NOT about raw speed - about efficient resource use
* Perfect for I/O-bound work like Redis replication
--

== Resources

[.col3-l]
--
* Project Reactor: https://projectreactor.io[projectreactor.io]
* Lettuce: https://lettuce.io[lettuce.io]
* https://github.com/redis-field-engineering/redis-cache-java[redis-field-engineering/redis-cache-java]
* This presentation: https://decks.ruaux.org/reactive[decks.ruaux.org/reactive]
--

[.col3-r]
--
image::qrcode.svg[QR Code,200,200]
--

